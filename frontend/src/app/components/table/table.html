<div class="mx-2 mt-6 bg-white shadow-lg rounded-lg max-h-6/12 overflow-auto mb-5 ">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-200">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Craft</th>

        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">City</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Website</th>
        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <tr *ngFor="let entry of paginatedEntries">
        <td class="px-6 whitespace-nowrap text-sm text-gray-900">{{ entry.name.trim() || '-' }}</td>
        <td class="px-6 whitespace-nowrap text-sm text-gray-900">{{ entry.craft.trim() || '-' }}</td>

        <td>
          <mat-form-field>
            <mat-label>Email</mat-label>

            <mat-select
              [(value)]="entry.selectedEmail"
              (selectionChange)="persistSelection(entry, 'selectedEmail', $event.value)"
              [disabled]="!entry.email?.trim()"
            >
              @if (entry.email?.trim()) {
                @for (email of entry.email.split(', '); track email) {
                  <mat-option [value]="email">{{ email }}</mat-option>
                }
              } @else {
                <mat-option disabled>-</mat-option>
              }
            </mat-select>
          </mat-form-field>

          @if (entry.selectedEmail) {
            <div class="mt-2">
              <a
                [href]="entry.selectedEmail"
                target="_blank"
                rel="noopener"
                class="text-blue-600 hover:underline"
              >
                {{ entry.selectedEmail }}
              </a>
            </div>
          } @else {
             <div class="mt-2">
              -
             </div>
          }
        </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ entry.city.trim() || '-' }}</td>
        <td>
          <mat-form-field>
            <mat-label>Website</mat-label>

            <mat-select
              [(value)]="entry.selectedWebsite"
              (selectionChange)="persistSelection(entry, 'selectedWebsite', $event.value)"
              [disabled]="!entry.website?.trim()"
            >
              @if (entry.website?.trim()) {
                @for (url of entry.website.split(', '); track url) {
                  <mat-option [value]="url">{{ url }}</mat-option>
                }
              } @else {
                <mat-option disabled>-</mat-option>
              }
            </mat-select>
          </mat-form-field>

          @if (entry.selectedWebsite) {
            <div class="mt-2">
              <a
                [href]="entry.selectedWebsite"
                target="_blank"
                rel="noopener"
                class="text-blue-600 hover:underline"
              >
                {{ entry.selectedWebsite }}
              </a>
            </div>
          } @else {
             <div class="mt-2">
              -
             </div>
          }
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-center flex">
        <button
          (click)="triggerAction(entry)"
          [disabled]="entry.isAnalyzing || entry.finishedAnalyzing"
          class="bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300
                text-white font-semibold py-1 px-3 rounded mr-5
                flex items-center justify-center min-w-[120px]"
        >
          @if (entry.isAnalyzing) {
            <mat-progress-spinner
              diameter="20"
              mode="indeterminate"
              color="white">
            </mat-progress-spinner>
          } @else {
            Web Analyse
          }
        </button>
          <button
            (click)="sendMail(entry)"
            [disabled]="entry.mailSent || !entry.selectedWebsite || !entry.selectedEmail"

            class="bg-white
            text-blue-600
            border-blue-500
              font-semibold
              py-1
              px-3
              rounded

              hover:bg-blue-300

              disabled:bg-gray-100
              disabled:text-gray-400
              disabled:border-gray-300
                disabled:cursor-not-allowed
              disabled:hover:bg-gray-100"
          >
            Email senden
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <mat-paginator
    [length]="filteredEntries.length"
    [pageSize]="5"
    [pageSizeOptions]="[5, 10, 25, 100]"
    [pageIndex]="this.currentPageIndex"
    (page)="onPageChange($event)"
    aria-label="Select page">
  </mat-paginator>
</div>
